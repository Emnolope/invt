<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Elegant Mobile Grid</title>
  <style>
    /* Web 2.0 Space-Maximized CSS */
    body {
      margin: 0;
      font: 14px 'Courier New', monospace;
      overflow-x: auto; /* ENABLED horizontal scroll on the entire body */
    }
    #App {
      max-width: none; /* Removed constraint to allow width expansion */
      width: fit-content; /* Width matches the inner grid content */
      margin: 0 auto;
    }
    #GridHeader, .Row {
      display: grid;
      /* Fixed column widths to enable scrolling: 40px (Thumb) + 4 Data columns */
      grid-template-columns: 40px 140px 140px 140px 166px; 
      width: 626px; /* Total fixed width for inner content */
      border-bottom: 1px solid #000;
      min-height: 16px; /* Reduced to minimum */
      align-items: center;
    }
    #GridHeader {
      font-weight: bold;
      background: #ccc;
    }
    .Cell {
      /* Removed all padding */
      overflow: hidden;
      white-space: nowrap;
      user-select: none;
      touch-action: manipulation;
    }
    .ThumbCell {
      text-align: center;
    }
    .Thumb {
      /* Collapsed height to fit text, removed margin/padding */
      width: 100%; 
      height: 14px; 
      background: #666;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
    }
    /* Stark, clear state indicators */
    .Selected {
      background: #8cf;
    } 
    .Editing {
      background: #ff8;
    }
    input {
      width: 98%;
      box-sizing: border-box;
      font: inherit;
      padding: 0; /* Removed padding */
      border: 1px solid #000;
    }
  </style>
</head>
<body>
  <div id="App">
    <div id="GridHeader"></div>
    <div id="GridBody"></div>
    <div style="padding:4px;text-align:center">
      <button onclick="logSelected()">LOG SELECTED CELL IDs</button>
      <button onclick="clearSelection()">CLEAR SELECTION</button>
    </div>
  </div>
  <script>
    // --- DATA & STATE ---
    const fieldNames = ['LocationPath', 'Category', 'Flag', 'Note']
    const dataKeys = {uuid:'data-uuid', id:'data-cell-id'}
    const inventory = {"20250604135552143":{thumbnail:"T1",LocationPath:"Bando.BoxA",Category:"c,t,b",Flag:"GET",Note:"Fire gloves"},"20250604135552144":{thumbnail:"T2",LocationPath:"Bando.BoxB",Category:"h,m",Flag:"INV",Note:"Power tool kit"},"20250604135552145":{thumbnail:"T3",LocationPath:"Shelf.L1",Category:"c",Flag:"PUT",Note:"Spare cables"},"20250604135552146":{thumbnail:"T4",LocationPath:"Rack.Bay2",Category:"t,b",Flag:"GET",Note:"Safety goggles"},"20250604135552147":{thumbnail:"T5",LocationPath:"Desk.Draw3",Category:"m",Flag:"INV",Note:"ID badge laminates"}}
    
    let selectedCells = new Set()
    let editingCellId = null
    let pressTimer = null
    let startX = 0, startY = 0
    const longPressTime = 500, moveTolerance = 10
    const D = document, H = D.getElementById('GridHeader'), B = D.getElementById('GridBody')

    // --- LOGGING ---
    const logNav = u=>console.log(`Maps:${u}`), logEdit = (i,v)=>console.log(`EDIT:${i}=${v}`)
    const logSelect = ()=>console.log(`SELECT:${selectedCells.size} [${[...selectedCells].join(',')}]`)
    const logSelected = ()=>console.log('Selected:',[...selectedCells])

    // --- SELECTION UTILITIES ---
    const clearSelection = ()=>{
      D.querySelectorAll('.Selected').forEach(c=>c.classList.remove('Selected'))
      selectedCells.clear(); logSelect()
    }
    const toggleSelection = (element, id)=>{
      selectedCells.has(id)?selectedCells.delete(id):selectedCells.add(id)
      element.classList.toggle('Selected'); logSelect()
    }

    // --- RENDERING ---
    const createHeader = ()=>{
      H.innerHTML='';
      ['ACT',...fieldNames].map(text=>{const c=D.createElement('div');c.className='HeaderCell';c.textContent=text;H.append(c)})
    }
    const renderInventory = ()=>{
      B.innerHTML='';
      Object.entries(inventory).map(([u,item])=>{
        const r=D.createElement('div');r.className='Row';r.setAttribute(dataKeys.uuid,u)

        // Leftmost Cell (Navigation)
        const tc=D.createElement('div');tc.className='Cell ThumbCell';tc.setAttribute(dataKeys.id,`${u}::t`)
        const td=D.createElement('div');td.className='Thumb';td.textContent=item.thumbnail
        tc.onclick=e=>{e.stopPropagation();editingCellId||logNav(u)};tc.append(td);r.append(tc)

        // Data Cells (Select/Edit)
        fieldNames.map(f=>{
          const c=D.createElement('div'),i=`${u}::${f}`
          c.className='Cell DataCell';c.setAttribute(dataKeys.id,i);c.textContent=item[f]
          selectedCells.has(i)&&c.classList.add('Selected')
          c.onclick=e=>handleTap(e,u,f,i)
          c.addEventListener('touchstart',handlePressStart)
          c.addEventListener('touchmove',handlePressMove)
          c.addEventListener('touchend',handlePressEnd)
          r.append(c)
        })
        B.append(r)
      })
    }

    // --- EDITING LOGIC ---
    const saveEdit = (u,f,input,masterCell)=>{
      const v=input.value
      if(selectedCells.size>0){
        selectedCells.forEach(i=>{
          const [tU,tF]=i.split('::')
          inventory[tU][tF]=v,logEdit(i,v)
          const tE=D.querySelector(`[${dataKeys.id}="${i}"]`)
          tE&&(tE.textContent=v,tE.classList.remove('Selected'))
        })
      }else{
        inventory[u][f]=v,logEdit(`${u}::${f}`,v)
      }
      masterCell.innerHTML='',masterCell.textContent=v,masterCell.classList.remove('Editing')
      clearSelection(),editingCellId=null
    }

    const handleTap = (e,u,f,i)=>{
      e.stopPropagation() 

      if(editingCellId)D.querySelector(`[${dataKeys.id}="${editingCellId}"] input`).blur()
      
      const c=e.currentTarget
      !selectedCells.has(i)&&clearSelection()
      
      editingCellId=i;c.classList.add('Editing')
      const input=D.createElement('input')
      input.type='text';input.value=inventory[u][f]
      c.textContent='';c.append(input);input.focus()
      
      input.onblur=()=>saveEdit(u,f,input,c)
      
      input.onkeydown = ev => {
        ev.stopPropagation()
        if(ev.key === 'Enter') ev.currentTarget.blur()
      }
    }

    // --- TOUCH/LONG-PRESS LOGIC ---
    const handlePressStart = e=>{
      if(editingCellId)return clearTimeout(pressTimer),pressTimer=null
      const c=e.currentTarget,i=c.getAttribute(dataKeys.id)
      startX=e.touches[0].clientX;startY=e.touches[0].clientY
      pressTimer=setTimeout(()=>{toggleSelection(c,i);pressTimer=null},longPressTime)
    }
    const handlePressMove = e=>{
      if(!pressTimer)return
      const dx=Math.abs(e.touches[0].clientX-startX),dy=Math.abs(e.touches[0].clientY-startY)
      if(dx>moveTolerance||dy>moveTolerance){clearTimeout(pressTimer);pressTimer=null}
    }
    const handlePressEnd = e=>pressTimer&&clearTimeout(pressTimer)

    // --- INIT ---
    createHeader(); renderInventory()
  </script>
</body>
</html>
